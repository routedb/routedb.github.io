<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

    <title>routeDB</title>
</head>

<body onload="init()">
    <div id="listJR">
    </div>
    <div id="list">
    </div>
    <script>
        const getCompany = async() => {
            const url = `https://routedb.github.io/dev/data/tmp_company.json`;
            const response = await fetch(url, {
                method: "get"
            });
            const json = response.json()
            if (response.status == 200) {
                return Promise.resolve(json);
            } else {
                return Promise.reject(json.error);
            }
        };
        const getLine = async(company) => {
            const url = `https://api.ekispert.jp/v1/json/rail?key=5F6YFMvV7wS2CSFP&corporationName=${company}`;
            const response = await fetch(url, {
                method: "get"
            });
            const json = response.json()
            if (response.status == 200) {
                return Promise.resolve(json);
            } else {
                return Promise.reject(json.error);
            }
        };
        const getLineJR = async(offset) => {
            const url = `https://api.ekispert.jp/v1/json/rail?key=5F6YFMvV7wS2CSFP&corporationName=JR&offset=${offset}`;
            const response = await fetch(url, {
                method: "get"
            });
            const json = response.json()
            if (response.status == 200) {
                return Promise.resolve(json);
            } else {
                return Promise.reject(json.error);
            }
        };

        const getLineList = async(Line) => {
            const url = `https://api.ekispert.jp/v1/json/station?key=5F6YFMvV7wS2CSFP&railName=${Line}&direction=up`;
            const response = await fetch(url, {
                method: "get"
            });
            const json = response.json()
            if (response.status == 200) {
                return Promise.resolve(json);
            } else {
                return Promise.reject(json.error);
            }
        };

        function init() {
            getCompany()
                .then((data) => {
                    console.log(data);
                    for (let idx in data) {
                        getLine(data[idx].company).then((lineData) => {
                                let out = "";
                                let line_name = "";
                                let prm_line_name = "";
                                if (lineData.ResultSet.Corporation.Name !== "ＪＲ") {
                                    console.log(lineData.ResultSet.Corporation.Name);
                                    out += lineData.ResultSet.Corporation.Name + "<br>";
                                    if (Array.isArray(lineData.ResultSet.Line)) {
                                        for (let line_idx in lineData.ResultSet.Line) {
                                            out += "┗" + lineData.ResultSet.Line[line_idx].Name + "<br>";
                                            prm_line_name = lineData.ResultSet.Line[line_idx].Name;
                                            console.log("┗" + lineData.ResultSet.Line[line_idx].Name);
                                        }
                                    } else {
                                        out += "┗" + lineData.ResultSet.Line.Name + "<br>";
                                        prm_line_name = lineData.ResultSet.Line.Name;
                                        console.log("┗" + lineData.ResultSet.Line.Name);
                                    }
                                    getLineList(prm_line_name).then((lineListData) => {
                                            for (let linelist_idx in lineListData.ResultSet.Point) {
                                                console.log("┗┗" + lineListData.ResultSet.Point[linelist_idx].Station.Name + "$" +
                                                    lineListData.ResultSet.Point[linelist_idx].Station.Yomi + "$" +
                                                    lineListData.ResultSet.Point[linelist_idx].Prefecture.Name + "$" +
                                                    lineListData.ResultSet.Point[linelist_idx].GeoPoint.lati_d + "$" +
                                                    lineListData.ResultSet.Point[linelist_idx].GeoPoint.longi_d)
                                            }
                                        })
                                        .catch((err) => {
                                            console.log(err);
                                        });
                                }
                                document.getElementById("list").innerHTML = document.getElementById("list").innerHTML + out;
                            })
                            .catch((err) => {
                                console.log(err);
                            });
                    }
                    const offsetarr = [1, 101, 201, 301, 401];
                    for (let idx in offsetarr) {
                        getLineJR(offsetarr[idx]).then((lineData) => {
                                let out = "";
                                let line_name = "";
                                let prm_line_name = "";
                                console.log(lineData.ResultSet.Corporation.Name);
                                out += lineData.ResultSet.Corporation.Name + "<br>";
                                if (Array.isArray(lineData.ResultSet.Line)) {
                                    for (let line_idx in lineData.ResultSet.Line) {
                                        out += "┗" + lineData.ResultSet.Line[line_idx].Name + "<br>";
                                        prm_line_name = lineData.ResultSet.Line[line_idx].Name;
                                        console.log("┗" + lineData.ResultSet.Line[line_idx].Name);
                                    }
                                } else {
                                    out += "┗" + lineData.ResultSet.Line.Name + "<br>";
                                    prm_line_name = lineData.ResultSet.Line.Name;
                                    console.log("┗" + lineData.ResultSet.Line.Name);
                                }
                                getLineList(prm_line_name).then((lineListData) => {
                                        for (let linelist_idx in lineListData.ResultSet.Point) {
                                            console.log("┗┗" + lineListData.ResultSet.Point[linelist_idx].Station.Name + "$" +
                                                lineListData.ResultSet.Point[linelist_idx].Station.Yomi + "$" +
                                                lineListData.ResultSet.Point[linelist_idx].Prefecture.Name + "$" +
                                                lineListData.ResultSet.Point[linelist_idx].GeoPoint.lati_d + "$" +
                                                lineListData.ResultSet.Point[linelist_idx].GeoPoint.longi_d)
                                        }
                                    })
                                    .catch((err) => {
                                        console.log(err);
                                    });
                                document.getElementById("listJR").innerHTML = document.getElementById("listJR").innerHTML + out;
                            })
                            .catch((err) => {
                                console.log(err);
                            });
                    }
                })
                .catch((err) => {
                    console.log(err);
                });
        }
    </script>
</body>