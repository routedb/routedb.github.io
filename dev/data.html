<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

    <title>routeDB</title>
</head>

<body onload="init()">
    <div id="listJR">
    </div>
    <div id="list">
    </div>
    <script>
        const getLine = async() => {
            const url = `https://routedb.github.io/dev/data/tmp_company_line.json`;
            const response = await fetch(url, {
                method: "get"
            });
            const json = response.json()
            if (response.status == 200) {
                return Promise.resolve(json);
            } else {
                return Promise.reject(json.error);
            }
        };

        const getLineList = async(Line) => {
            const url = `https://api.ekispert.jp/v1/json/station?key=5F6YFMvV7wS2CSFP&railName=${Line}&direction=up`;
            const response = await fetch(url, {
                method: "get"
            });
            const json = response.json()
            if (response.status == 200) {
                return Promise.resolve(json);
            } else {
                return Promise.reject(json.error);
            }
        };

        function init() {
            getLine()
                .then((data) => {
                    console.log(data);
                    for (let idx in data) {
                        console.log(data[idx].company)
                        console.log("┗" + data[idx].line)
                        getLineList(data[idx].line).then((lineListData) => {
                                for (let linelist_idx in lineListData.ResultSet.Point) {
                                    console.log("┗┗" + lineListData.ResultSet.Point[linelist_idx].Station.Name + "$" +
                                        lineListData.ResultSet.Point[linelist_idx].Station.Yomi + "$" +
                                        lineListData.ResultSet.Point[linelist_idx].Prefecture.Name + "$" +
                                        lineListData.ResultSet.Point[linelist_idx].GeoPoint.lati_d + "$" +
                                        lineListData.ResultSet.Point[linelist_idx].GeoPoint.longi_d)
                                }
                            })
                            .catch((err) => {
                                console.log(err);
                            });
                    }
                })
                .catch((err) => {});

        }
    </script>
</body>